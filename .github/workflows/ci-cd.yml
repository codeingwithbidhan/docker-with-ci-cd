[Immersive content redacted for brevity.]
          script: |
            cd /home/${{ secrets.SERVER_USER }}/docker-with-ci-cd
            
            echo "--- Starting Containers (Blocking) ---"
            # TTY enabled. Simple 'up -d' is used to avoid non-detaching issues.
            sudo /usr/local/bin/docker-compose -f docker-compose.production.yml up -d || {
                echo "FATAL ERROR: docker-compose up failed immediately."
                sudo /usr/local/bin/docker-compose -f docker-compose.production.yml logs
                exit 1
            }
            
            echo "Containers detaching complete. Starting health check loop..."
            
            MAX_WAIT=120
            COUNTER=0
            LARAVEL_CONTAINER_NAME=""

            # üö® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶π‡ßá‡¶≤‡¶• ‡¶ö‡ßá‡¶ï ‡¶≤‡ßÅ‡¶™: ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ 120 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá
            while [ $COUNTER -lt $MAX_WAIT ]; do
                LARAVEL_CONTAINER_NAME=$(sudo /usr/local/bin/docker-compose -f docker-compose.production.yml ps -q backend) 
                
                if [ -n "$LARAVEL_CONTAINER_NAME" ]; then
                    CONTAINER_STATUS=$(sudo /usr/bin/docker inspect -f '{{.State.Status}}' $LARAVEL_CONTAINER_NAME)
                    
                    if [ "$CONTAINER_STATUS" = "running" ]; then
                        echo "Backend container is RUNNING after $COUNTER seconds."
                        break
                    fi
                fi
                
                echo "Waiting for backend container to run ($((MAX_WAIT - COUNTER))s remaining)..."
                sleep 5
                COUNTER=$((COUNTER + 5))
            done

            # ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï
            if [ "$CONTAINER_STATUS" = "running" ]; then
                echo "Waiting 10 seconds for DB connection establishment before migrations...";
                sleep 10
                  
                # ‡¶Æ‡¶æ‡¶á‡¶ó‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ì ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                echo "Running Migrations..."
                sudo /usr/bin/docker exec $LARAVEL_CONTAINER_NAME php artisan migrate --force;
                sudo /usr/bin/docker exec $LARAVEL_CONTAINER_NAME php artisan cache:clear;
                echo "Deployment successful!";
            else
                echo "Error: Backend container failed to run within $MAX_WAIT seconds."
                echo "--- Printing Full Docker Compose Logs for Diagnosis ---"
                sudo /usr/local/bin/docker-compose -f docker-compose.production.yml logs 
                exit 1;
            fi
